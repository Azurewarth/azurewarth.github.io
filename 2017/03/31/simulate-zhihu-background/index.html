<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"name="viewport">
  <title>Azurewarth</title>
  <link rel="stylesheet" href="/css/style.css">
  <script src="/js/canvas.js"></script>
</head>
  <body>
    <header class="header">
    <div class="blog-title">
        <a href="https://github.com/Azurewarth" class="logo">Azurewarth</a>
    </div>
    <div class="blog-subtitle">
        my blog -- 247
    </div>
    <ul class="menu">
        
        <li class="menu-item">
            <a href="/" class="menu-item-link">Home</a>
        </li>
        
        <li class="menu-item">
            <a href="/archives" class="menu-item-link">Archive</a>
        </li>
        
        <li class="menu-item">
            <a href="/tags" class="menu-item-link">Tag</a>
        </li>
        
        <li class="menu-item">
            <a href="https://github.com/Azurewarth" class="menu-item-link">github</a>
        </li>
        
    </ul> 
</header>

    <main class="main">
      <article class="post">
  <div class="post-title">
    <h2 class="title">Simulate zhihu background</h2>
  </div>
   <div class="post-meta">
    <span class="post-time">2017-03-31</span>
  </div>
  <div class="post-content">
    <h1 id="Try-to-use-canvas-to-build-a-dynamic-background"><a href="#Try-to-use-canvas-to-build-a-dynamic-background" class="headerlink" title="Try to use canvas to build a dynamic background"></a>Try to use canvas to build a dynamic background</h1><h2 id="Just-like-zhihu-login-page"><a href="#Just-like-zhihu-login-page" class="headerlink" title="Just like zhihu login page"></a>Just like zhihu login page</h2><a id="more"></a>
<p>OK shut up and show the codes</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> oCG 	  = <span class="built_in">document</span>.getElementById(<span class="string">'background-canvas'</span>);</div><div class="line"><span class="keyword">var</span> oCGR 	  = oCG.getContext(<span class="string">'2d'</span>);</div><div class="line"><span class="keyword">var</span> WIDTH 	  = <span class="built_in">window</span>.innerWidth;</div><div class="line"><span class="keyword">var</span> HEIGHT 	  = <span class="built_in">window</span>.innerHeight;</div><div class="line"><span class="keyword">var</span> POINT  	  = <span class="number">40</span>;</div><div class="line"><span class="keyword">var</span> R 	 	  = <span class="number">10</span>;</div><div class="line"><span class="keyword">var</span> circleArr = [];</div><div class="line">oCG.width = WIDTH;</div><div class="line">oCG.height = HEIGHT;</div><div class="line">oCG.style.backgroundColor = <span class="string">'#f1f1f1'</span>;</div></pre></td></tr></table></figure>
<p>Define constants and define arr to save the circles.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawLine</span>(<span class="params">x, y, xx, yy, o</span>) </span>&#123;</div><div class="line">	oCGR.beginPath();</div><div class="line">	oCGR.strokeStyle = <span class="string">'rgba(0,0,0,'</span> + o + <span class="string">')'</span>;</div><div class="line">	oCGR.moveTo(x, y);</div><div class="line">	oCGR.lineTo(xx, yy);</div><div class="line">	oCGR.closePath();</div><div class="line">	oCGR.stroke();</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawCircle</span>(<span class="params">x, y, r</span>) </span>&#123;</div><div class="line">	oCGR.beginPath();</div><div class="line">	oCGR.fillStyle = <span class="string">'rgba(0,0,0,.4)'</span>;</div><div class="line">	oCGR.arc(x, y, r, <span class="number">0</span>, <span class="number">2</span>*<span class="built_in">Math</span>.PI);</div><div class="line">	oCGR.closePath();</div><div class="line">	oCGR.fill();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Two functions to draw the circles and the lines between each other.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>) </span>&#123;	</div><div class="line">    <span class="keyword">var</span> i;</div><div class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; POINT; i++) &#123;</div><div class="line">        <span class="keyword">var</span> temp1 = <span class="built_in">Math</span>.random() &gt; <span class="number">0.5</span> ? <span class="number">1</span> : <span class="number">-1</span>;</div><div class="line">        <span class="keyword">var</span> temp2 = <span class="built_in">Math</span>.random() &gt; <span class="number">0.5</span> ? <span class="number">1</span> : <span class="number">-1</span>;</div><div class="line">        circleArr.push(&#123; </div><div class="line">            <span class="attr">x</span>: WIDTH * <span class="built_in">Math</span>.random(), </div><div class="line">            <span class="attr">y</span>: HEIGHT * <span class="built_in">Math</span>.random(), </div><div class="line">            <span class="attr">r</span>: R * <span class="built_in">Math</span>.random(),</div><div class="line">            <span class="attr">moveX</span>: temp1 * <span class="built_in">Math</span>.random(),</div><div class="line">            <span class="attr">moveY</span>: temp2 * <span class="built_in">Math</span>.random(),</div><div class="line">        &#125;)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    oCGR.clearRect(<span class="number">0</span>, <span class="number">0</span>, WIDTH, HEIGHT);</div><div class="line">    <span class="keyword">var</span> i,j,k;</div><div class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; POINT; i++) &#123;</div><div class="line">        <span class="keyword">var</span> circle = circleArr[i];</div><div class="line">        drawCircle(circle.x, circle.y, circle.r);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; POINT; j++) &#123;</div><div class="line">        <span class="keyword">for</span>(k = <span class="number">0</span>; k &lt; POINT; k++) &#123;</div><div class="line">            <span class="keyword">if</span>( j !== k) &#123;</div><div class="line">                <span class="keyword">var</span> A = <span class="built_in">Math</span>.abs(circleArr[k].x - circleArr[j].x);</div><div class="line">                <span class="keyword">var</span>	B = <span class="built_in">Math</span>.abs(circleArr[k].y - circleArr[j].y);</div><div class="line">                <span class="keyword">var</span> lineLength = <span class="built_in">Math</span>.sqrt(A*A + B*B);</div><div class="line">                <span class="keyword">var</span> C = <span class="number">1</span>/lineLength*<span class="number">7</span><span class="number">-0.009</span>;</div><div class="line">                <span class="keyword">var</span> lineOpacity = C &gt; <span class="number">0.03</span> ? <span class="number">0.03</span> : C;</div><div class="line">                <span class="keyword">if</span> (lineOpacity &gt; <span class="number">0</span>) &#123;</div><div class="line">                    drawLine(circleArr[j].x, circleArr[j].y, </div><div class="line">                    circleArr[k].x, circleArr[k].y, lineOpacity);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Use init function to create circleArr and draw function to draw the circles and lines on the canvas.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">move</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> i;</div><div class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; POINT; i++) &#123;</div><div class="line">        <span class="keyword">var</span> circle = circleArr[i];</div><div class="line">        circle.x += circle.moveX;</div><div class="line">        circle.y += circle.moveY;</div><div class="line">        <span class="keyword">if</span>(circle.x &gt; WIDTH || circle.x &lt; <span class="number">0</span>)&#123;</div><div class="line">            circle.moveX *= <span class="number">-1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(circle.y &gt; HEIGHT || circle.y &lt; <span class="number">0</span>)&#123;</div><div class="line">            circle.moveY *= <span class="number">-1</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Move function will make circles move on the canvas.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    init();</div><div class="line">    setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        draw();</div><div class="line">        move();</div><div class="line">    &#125;, <span class="number">16</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Finally, when the window loaded, the canvas will be painted again and again to show dynamic changes.</p>
<p>Besides, use css to make the canvas position right(not showing codes here).</p>

  </div>
</article>
    </main>
    <div>
	<canvas id="background-canvas"></canvas>
</div>
  </body>
</html>